# 服务器手动执行命令

## 方式 1: 通过 SSH 连接后执行

```bash
# 1. 连接到服务器
ssh ubuntu@119.45.121.152

# 2. 进入项目目录
cd /var/www/aigc-agent

# 3. 查找 Node.js
which node || which nodejs
# 或者
find /usr -name node 2>/dev/null | grep -E 'bin/node$' | head -1

# 4. 假设找到的是 /usr/bin/nodejs，配置 PATH
export PATH="/usr/bin:$PATH"

# 5. 验证
node --version || nodejs --version

# 6. 永久添加到 ~/.bashrc
echo 'export PATH="/usr/bin:$PATH"' >> ~/.bashrc

# 7. 检查语法错误
cd server
node --check index.js
node --check services/*.js

# 8. 如果语法正确，重启服务
pm2 restart aigc-agent
```

## 方式 2: 一行命令执行

```bash
ssh ubuntu@119.45.121.152 "cd /var/www/aigc-agent && export PATH=\"/usr/bin:\$PATH\" && node --version && cd server && node --check index.js"
```

## 方式 3: 如果 Node.js 在 /usr/bin/nodejs

```bash
ssh ubuntu@119.45.121.152 << 'EOF'
cd /var/www/aigc-agent
export PATH="/usr/bin:$PATH"
echo "Node.js 版本: $(nodejs --version 2>/dev/null || node --version)"
cd server
echo "检查语法..."
nodejs --check index.js && echo "✅ index.js 语法正确" || echo "❌ index.js 有错误"
for file in services/*.js; do
    if [ -f "$file" ]; then
        if nodejs --check "$file" > /dev/null 2>&1; then
            echo "✅ $(basename $file)"
        else
            echo "❌ $(basename $file)"
            nodejs --check "$file" 2>&1 | head -3
        fi
    fi
done
EOF
```

## 方式 4: 从 PM2 获取 Node.js 路径

```bash
ssh ubuntu@119.45.121.152 << 'EOF'
# 从 PM2 获取 node 路径
PM2_NODE=$(pm2 info aigc-agent 2>/dev/null | grep "exec path" | awk '{print $4}' | head -1)
if [ -n "$PM2_NODE" ]; then
    NODE_DIR=$(dirname "$PM2_NODE")
    echo "Node.js 目录: $NODE_DIR"
    export PATH="$NODE_DIR:$PATH"
    echo "已添加到 PATH"
    node --version
fi
EOF
```

## 常见问题排查

### 如果找不到 node 命令

```bash
# 搜索整个系统
find /usr -name node 2>/dev/null
find /opt -name node 2>/dev/null
find /home -name node 2>/dev/null

# 检查是否安装了 nodejs（Ubuntu 包名）
dpkg -l | grep nodejs

# 如果安装了 nodejs 但没有 node，创建符号链接
sudo ln -s /usr/bin/nodejs /usr/local/bin/node
```

### 如果语法检查失败

```bash
# 查看具体错误
cd /var/www/aigc-agent/server
nodejs --check index.js

# 检查所有服务文件
for file in services/*.js; do
    echo "检查: $file"
    nodejs --check "$file" 2>&1
done
```

### 修复语法错误后重启服务

```bash
# 重启 PM2 服务
pm2 restart aigc-agent

# 查看日志
pm2 logs aigc-agent --lines 50

# 如果还有错误，查看详细日志
pm2 logs aigc-agent --err --lines 100
```




