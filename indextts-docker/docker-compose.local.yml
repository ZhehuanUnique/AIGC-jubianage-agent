services:
  indextts:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: indextts-api-local
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      # 直接挂载本地 Windows 路径（Docker Desktop for Windows 支持）
      # 注意：路径格式使用 /e/ 而不是 E:\
      - /e/IndexTTS2.5/checkpoints:/app/checkpoints:ro
      # 输出目录（可写）
      - ./outputs:/app/outputs
    environment:
      - PYTHONUNBUFFERED=1
      - CHECKPOINT_PATH=/app/checkpoints
      - CONFIG_PATH=/app/checkpoints/config.yaml
      - OUTPUT_PATH=/app/outputs
      - PORT=8000
      - DEVICE=cpu  # 本地如果没有 GPU，使用 cpu
      - USE_FP16=False  # CPU 模式建议关闭 FP16
      - USE_CUDA_KERNEL=False
      - USE_DEEPSPEED=False
      - LOG_LEVEL=INFO
    networks:
      - indextts-network
    # 资源限制（本地运行可以适当调整）
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G

networks:
  indextts-network:
    driver: bridge

