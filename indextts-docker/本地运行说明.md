# IndexTTS2.5 本地 Docker 运行说明

## 两种部署方案对比

### 方案1：本地运行 Docker（推荐，无需传输文件）

**优点：**
- ✅ 不需要传输 20GB 文件到服务器
- ✅ 直接使用本地模型文件
- ✅ 部署快速

**缺点：**
- ⚠️ 需要本地有 Docker Desktop
- ⚠️ API 只能从本地访问（或需要配置端口转发）

### 方案2：服务器运行 Docker（需要传输文件）

**优点：**
- ✅ 可以在服务器上稳定运行
- ✅ 可以从任何地方访问 API
- ✅ 不占用本地资源

**缺点：**
- ⚠️ 需要传输 20GB 文件到服务器（耗时）
- ⚠️ 需要服务器有足够磁盘空间

## 本地运行步骤

### 前置条件

1. **安装 Docker Desktop for Windows**
   - 下载：https://www.docker.com/products/docker-desktop
   - 安装并启动 Docker Desktop

2. **确认模型文件位置**
   - 确保 `E:\IndexTTS2.5\checkpoints` 存在
   - 确保 `E:\IndexTTS2.5\checkpoints\config.yaml` 存在

### 步骤1：进入项目目录

```powershell
cd C:\Users\Administrator\Desktop\AIGC-jubianage-agent\indextts-docker
```

### 步骤2：构建 Docker 镜像

```powershell
docker-compose -f docker-compose.local.yml build
```

### 步骤3：启动服务

```powershell
docker-compose -f docker-compose.local.yml up -d
```

### 步骤4：查看日志

```powershell
docker-compose -f docker-compose.local.yml logs -f
```

### 步骤5：测试 API

```powershell
# 健康检查
curl http://localhost:8000/health

# 测试 TTS（需要准备音频文件）
curl -X POST http://localhost:8000/tts `
  -H "Content-Type: application/json" `
  -d '{"spk_audio_prompt": "base64_audio", "text": "测试文本", "output_format": "wav"}'
```

## 路径说明

在 Docker Desktop for Windows 中：
- Windows 路径 `E:\IndexTTS2.5\checkpoints` 
- 在 Docker 中映射为 `/e/IndexTTS2.5/checkpoints`
- 容器内挂载到 `/app/checkpoints`

## 如果路径映射失败

如果 Docker Desktop 无法访问 E 盘，可以：

1. **在 Docker Desktop 设置中共享 E 盘**
   - 打开 Docker Desktop
   - Settings → Resources → File Sharing
   - 添加 E 盘到共享列表

2. **或者复制模型文件到项目目录**
   ```powershell
   # 复制到项目目录
   xcopy /E /I E:\IndexTTS2.5\checkpoints .\checkpoints
   # 然后修改 docker-compose.local.yml 中的路径为：
   # - ./checkpoints:/app/checkpoints:ro
   ```

## 停止服务

```powershell
docker-compose -f docker-compose.local.yml down
```

## 更新后端配置

如果本地运行，后端需要访问本地 API：

在 `server/.env` 中：

```env
# 如果后端也在本地运行
INDEXTTS_BASE_URL=http://localhost:8000

# 如果后端在服务器上，需要配置端口转发或使用服务器 IP
# INDEXTTS_BASE_URL=http://你的本地IP:8000
```

## 服务器运行（如果需要）

如果最终还是要在服务器上运行，才需要传输文件：

```powershell
# 1. 创建目录
ssh ubuntu@119.45.121.152 "mkdir -p /var/www/indextts-docker/checkpoints"

# 2. 传输文件
scp -r E:\IndexTTS2.5\checkpoints ubuntu@119.45.121.152:/var/www/indextts-docker/checkpoints

# 3. 在服务器上运行
ssh ubuntu@119.45.121.152
cd /var/www/indextts-docker
docker-compose up -d
```









