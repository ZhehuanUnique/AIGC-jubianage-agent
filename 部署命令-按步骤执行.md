# è…¾è®¯äº‘ CVM éƒ¨ç½²å‘½ä»¤ - æŒ‰æ­¥éª¤æ‰§è¡Œ

## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯

- **IPåœ°å€**ï¼š119.45.121.152
- **åŸŸå**ï¼šjubianai.cn
- **ç”¨æˆ·å**ï¼šubuntu
- **å¯†ç **ï¼šrXTg#!G$6c45yxZ

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

åœ¨æœ¬åœ° PowerShell æˆ– CMD ä¸­æ‰§è¡Œï¼š

```bash
ssh ubuntu@119.45.121.152
```

è¾“å…¥å¯†ç ï¼š`rXTg#!G$6c45yxZ`

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ éƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼Œæˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼‰

**æ–¹æ³•1ï¼šä½¿ç”¨ SCP ä¸Šä¼ è„šæœ¬ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰**

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
scp deploy-to-tencent-cloud.sh ubuntu@119.45.121.152:/tmp/
scp setup-nginx-config.sh ubuntu@119.45.121.152:/tmp/
scp setup-ssl.sh ubuntu@119.45.121.152:/tmp/
```

**æ–¹æ³•2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼ˆæ¨èï¼‰**

è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œä½¿ç”¨ `nano` æˆ– `vim` åˆ›å»ºè„šæœ¬æ–‡ä»¶ã€‚

---

### ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²

#### 3.1 æ‰§è¡Œç¯å¢ƒå®‰è£…è„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /tmp/deploy-to-tencent-cloud.sh

# æ‰§è¡Œè„šæœ¬
bash /tmp/deploy-to-tencent-cloud.sh
```

**æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤**ï¼š

```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£… Node.js (NVM)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# 3. å®‰è£… PM2
npm install -g pm2

# 4. å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# 5. å®‰è£… Git
sudo apt install git -y

# 6. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/aigc-agent
sudo chown ubuntu:ubuntu /var/www/aigc-agent

# 7. å…‹éš†ä»£ç 
cd /var/www/aigc-agent
git clone https://github.com/ZhehuanUnique/AIGC-jubianage-agent.git .

# 8. å®‰è£…ä¾èµ–
npm install
cd server
npm install
cd ..

# 9. æ„å»ºå‰ç«¯
npm run build
```

---

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/aigc-agent/server
cp env.example .env
nano .env
```

**å¿…é¡»é…ç½®çš„å˜é‡**ï¼š

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3002

# é€šä¹‰åƒé—® API å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
DASHSCOPE_API_KEY=sk-your-api-key-here

# æ¨¡å‹é€‰æ‹©
QWEN_MODEL=qwen-plus

# Supabase æ•°æ®åº“è¿æ¥ï¼ˆå¿…éœ€ï¼‰
# ä½¿ç”¨ Supabase è¿æ¥å­—ç¬¦ä¸²ï¼ˆSession Poolerï¼‰
DATABASE_URL=postgresql://postgres.ogndfzxtzsifaqwzfojs:your-password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# è…¾è®¯äº‘ COS é…ç½®ï¼ˆå¿…éœ€ï¼‰
COS_SECRET_ID=your-secret-id
COS_SECRET_KEY=your-secret-key
COS_REGION=ap-guangzhou
COS_BUCKET=your-bucket-name

# JWT å¯†é’¥ï¼ˆå¿…éœ€ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-random-jwt-secret-key-here
```

**ä¿å­˜æ–‡ä»¶**ï¼šæŒ‰ `Ctrl + X`ï¼Œç„¶åæŒ‰ `Y`ï¼Œæœ€åæŒ‰ `Enter`

---

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd /var/www/aigc-agent/server
pm2 start index.js --name aigc-agent
pm2 save

# è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¾“å‡ºçš„ sudo å‘½ä»¤
```

**éªŒè¯æœåŠ¡**ï¼š

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-agent

# æµ‹è¯• API
curl http://localhost:3002/health
```

---

### ç¬¬å…­æ­¥ï¼šé…ç½® Nginx

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-nginx-config.sh
bash /tmp/setup-nginx-config.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/aigc-agent
```

**å¤åˆ¶ä»¥ä¸‹å†…å®¹**ï¼š

```nginx
server {
    listen 80;
    server_name jubianai.cn www.jubianai.cn;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/aigc-agent/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åç«¯ API
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /var/www/aigc-agent/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**å¯ç”¨é…ç½®**ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/aigc-agent /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx
```

---

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® SSL è¯ä¹¦

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-ssl.sh
bash /tmp/setup-ssl.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d jubianai.cn -d www.jubianai.cn

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

### ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾ç«¯å£
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

### ç¬¬ä¹æ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 status

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥åç«¯ API
curl http://localhost:3002/health

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /var/www/aigc-agent/dist
```

**è®¿é—®ç½‘ç«™**ï¼š
- HTTPï¼šhttp://jubianai.cn
- HTTPSï¼šhttps://jubianai.cnï¼ˆé…ç½® SSL åï¼‰

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 ç®¡ç†

```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs aigc-agent     # æŸ¥çœ‹æ—¥å¿—
pm2 restart aigc-agent  # é‡å¯
pm2 stop aigc-agent     # åœæ­¢
pm2 delete aigc-agent   # åˆ é™¤
```

### Nginx ç®¡ç†

```bash
sudo systemctl status nginx    # æŸ¥çœ‹çŠ¶æ€
sudo systemctl restart nginx   # é‡å¯
sudo systemctl reload nginx    # é‡æ–°åŠ è½½é…ç½®
sudo nginx -t                  # æµ‹è¯•é…ç½®
```

### æ›´æ–°ä»£ç 

```bash
cd /var/www/aigc-agent
git pull origin main
npm install
cd server && npm install && cd ..
npm run build
pm2 restart aigc-agent
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¿æ¥å’Œ API å¯†é’¥
2. **åŸŸåè§£æ**ï¼šç¡®ä¿åŸŸå `jubianai.cn` å·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP `119.45.121.152`
3. **å®‰å…¨ç»„**ï¼šåœ¨è…¾è®¯äº‘æ§åˆ¶å°ç¡®ä¿å®‰å…¨ç»„å·²å¼€æ”¾ 22ã€80ã€443 ç«¯å£
4. **JWT å¯†é’¥**ï¼šç”Ÿæˆä¸€ä¸ªå¼ºéšæœºå­—ç¬¦ä¸²ä½œä¸º JWT_SECRET

---

## ğŸ› æ•…éšœæ’æŸ¥

### æ— æ³•è¿æ¥æœåŠ¡å™¨
- æ£€æŸ¥ IP åœ°å€å’Œå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 22 ç«¯å£

### PM2 æœåŠ¡æ— æ³•å¯åŠ¨
- æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs aigc-agent`
- æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`cat /var/www/aigc-agent/server/.env`
- æ‰‹åŠ¨æµ‹è¯•ï¼š`cd /var/www/aigc-agent/server && node index.js`

### Nginx 502 é”™è¯¯
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`pm2 status`
- æ£€æŸ¥ç«¯å£ï¼š`curl http://localhost:3002/health`
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`

### ç½‘ç«™æ— æ³•è®¿é—®
- æ£€æŸ¥ DNS è§£æï¼š`ping jubianai.cn`
- æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`
- æ£€æŸ¥ Nginxï¼š`sudo systemctl status nginx`


## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯

- **IPåœ°å€**ï¼š119.45.121.152
- **åŸŸå**ï¼šjubianai.cn
- **ç”¨æˆ·å**ï¼šubuntu
- **å¯†ç **ï¼šrXTg#!G$6c45yxZ

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

åœ¨æœ¬åœ° PowerShell æˆ– CMD ä¸­æ‰§è¡Œï¼š

```bash
ssh ubuntu@119.45.121.152
```

è¾“å…¥å¯†ç ï¼š`rXTg#!G$6c45yxZ`

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ éƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼Œæˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼‰

**æ–¹æ³•1ï¼šä½¿ç”¨ SCP ä¸Šä¼ è„šæœ¬ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰**

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
scp deploy-to-tencent-cloud.sh ubuntu@119.45.121.152:/tmp/
scp setup-nginx-config.sh ubuntu@119.45.121.152:/tmp/
scp setup-ssl.sh ubuntu@119.45.121.152:/tmp/
```

**æ–¹æ³•2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼ˆæ¨èï¼‰**

è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œä½¿ç”¨ `nano` æˆ– `vim` åˆ›å»ºè„šæœ¬æ–‡ä»¶ã€‚

---

### ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²

#### 3.1 æ‰§è¡Œç¯å¢ƒå®‰è£…è„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /tmp/deploy-to-tencent-cloud.sh

# æ‰§è¡Œè„šæœ¬
bash /tmp/deploy-to-tencent-cloud.sh
```

**æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤**ï¼š

```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£… Node.js (NVM)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# 3. å®‰è£… PM2
npm install -g pm2

# 4. å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# 5. å®‰è£… Git
sudo apt install git -y

# 6. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/aigc-agent
sudo chown ubuntu:ubuntu /var/www/aigc-agent

# 7. å…‹éš†ä»£ç 
cd /var/www/aigc-agent
git clone https://github.com/ZhehuanUnique/AIGC-jubianage-agent.git .

# 8. å®‰è£…ä¾èµ–
npm install
cd server
npm install
cd ..

# 9. æ„å»ºå‰ç«¯
npm run build
```

---

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/aigc-agent/server
cp env.example .env
nano .env
```

**å¿…é¡»é…ç½®çš„å˜é‡**ï¼š

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3002

# é€šä¹‰åƒé—® API å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
DASHSCOPE_API_KEY=sk-your-api-key-here

# æ¨¡å‹é€‰æ‹©
QWEN_MODEL=qwen-plus

# Supabase æ•°æ®åº“è¿æ¥ï¼ˆå¿…éœ€ï¼‰
# ä½¿ç”¨ Supabase è¿æ¥å­—ç¬¦ä¸²ï¼ˆSession Poolerï¼‰
DATABASE_URL=postgresql://postgres.ogndfzxtzsifaqwzfojs:your-password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# è…¾è®¯äº‘ COS é…ç½®ï¼ˆå¿…éœ€ï¼‰
COS_SECRET_ID=your-secret-id
COS_SECRET_KEY=your-secret-key
COS_REGION=ap-guangzhou
COS_BUCKET=your-bucket-name

# JWT å¯†é’¥ï¼ˆå¿…éœ€ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-random-jwt-secret-key-here
```

**ä¿å­˜æ–‡ä»¶**ï¼šæŒ‰ `Ctrl + X`ï¼Œç„¶åæŒ‰ `Y`ï¼Œæœ€åæŒ‰ `Enter`

---

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd /var/www/aigc-agent/server
pm2 start index.js --name aigc-agent
pm2 save

# è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¾“å‡ºçš„ sudo å‘½ä»¤
```

**éªŒè¯æœåŠ¡**ï¼š

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-agent

# æµ‹è¯• API
curl http://localhost:3002/health
```

---

### ç¬¬å…­æ­¥ï¼šé…ç½® Nginx

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-nginx-config.sh
bash /tmp/setup-nginx-config.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/aigc-agent
```

**å¤åˆ¶ä»¥ä¸‹å†…å®¹**ï¼š

```nginx
server {
    listen 80;
    server_name jubianai.cn www.jubianai.cn;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/aigc-agent/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åç«¯ API
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /var/www/aigc-agent/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**å¯ç”¨é…ç½®**ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/aigc-agent /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx
```

---

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® SSL è¯ä¹¦

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-ssl.sh
bash /tmp/setup-ssl.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d jubianai.cn -d www.jubianai.cn

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

### ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾ç«¯å£
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

### ç¬¬ä¹æ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 status

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥åç«¯ API
curl http://localhost:3002/health

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /var/www/aigc-agent/dist
```

**è®¿é—®ç½‘ç«™**ï¼š
- HTTPï¼šhttp://jubianai.cn
- HTTPSï¼šhttps://jubianai.cnï¼ˆé…ç½® SSL åï¼‰

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 ç®¡ç†

```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs aigc-agent     # æŸ¥çœ‹æ—¥å¿—
pm2 restart aigc-agent  # é‡å¯
pm2 stop aigc-agent     # åœæ­¢
pm2 delete aigc-agent   # åˆ é™¤
```

### Nginx ç®¡ç†

```bash
sudo systemctl status nginx    # æŸ¥çœ‹çŠ¶æ€
sudo systemctl restart nginx   # é‡å¯
sudo systemctl reload nginx    # é‡æ–°åŠ è½½é…ç½®
sudo nginx -t                  # æµ‹è¯•é…ç½®
```

### æ›´æ–°ä»£ç 

```bash
cd /var/www/aigc-agent
git pull origin main
npm install
cd server && npm install && cd ..
npm run build
pm2 restart aigc-agent
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¿æ¥å’Œ API å¯†é’¥
2. **åŸŸåè§£æ**ï¼šç¡®ä¿åŸŸå `jubianai.cn` å·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP `119.45.121.152`
3. **å®‰å…¨ç»„**ï¼šåœ¨è…¾è®¯äº‘æ§åˆ¶å°ç¡®ä¿å®‰å…¨ç»„å·²å¼€æ”¾ 22ã€80ã€443 ç«¯å£
4. **JWT å¯†é’¥**ï¼šç”Ÿæˆä¸€ä¸ªå¼ºéšæœºå­—ç¬¦ä¸²ä½œä¸º JWT_SECRET

---

## ğŸ› æ•…éšœæ’æŸ¥

### æ— æ³•è¿æ¥æœåŠ¡å™¨
- æ£€æŸ¥ IP åœ°å€å’Œå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 22 ç«¯å£

### PM2 æœåŠ¡æ— æ³•å¯åŠ¨
- æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs aigc-agent`
- æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`cat /var/www/aigc-agent/server/.env`
- æ‰‹åŠ¨æµ‹è¯•ï¼š`cd /var/www/aigc-agent/server && node index.js`

### Nginx 502 é”™è¯¯
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`pm2 status`
- æ£€æŸ¥ç«¯å£ï¼š`curl http://localhost:3002/health`
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`

### ç½‘ç«™æ— æ³•è®¿é—®
- æ£€æŸ¥ DNS è§£æï¼š`ping jubianai.cn`
- æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`
- æ£€æŸ¥ Nginxï¼š`sudo systemctl status nginx`


## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯

- **IPåœ°å€**ï¼š119.45.121.152
- **åŸŸå**ï¼šjubianai.cn
- **ç”¨æˆ·å**ï¼šubuntu
- **å¯†ç **ï¼šrXTg#!G$6c45yxZ

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

åœ¨æœ¬åœ° PowerShell æˆ– CMD ä¸­æ‰§è¡Œï¼š

```bash
ssh ubuntu@119.45.121.152
```

è¾“å…¥å¯†ç ï¼š`rXTg#!G$6c45yxZ`

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ éƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼Œæˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼‰

**æ–¹æ³•1ï¼šä½¿ç”¨ SCP ä¸Šä¼ è„šæœ¬ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰**

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
scp deploy-to-tencent-cloud.sh ubuntu@119.45.121.152:/tmp/
scp setup-nginx-config.sh ubuntu@119.45.121.152:/tmp/
scp setup-ssl.sh ubuntu@119.45.121.152:/tmp/
```

**æ–¹æ³•2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬ï¼ˆæ¨èï¼‰**

è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œä½¿ç”¨ `nano` æˆ– `vim` åˆ›å»ºè„šæœ¬æ–‡ä»¶ã€‚

---

### ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²

#### 3.1 æ‰§è¡Œç¯å¢ƒå®‰è£…è„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /tmp/deploy-to-tencent-cloud.sh

# æ‰§è¡Œè„šæœ¬
bash /tmp/deploy-to-tencent-cloud.sh
```

**æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤**ï¼š

```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£… Node.js (NVM)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# 3. å®‰è£… PM2
npm install -g pm2

# 4. å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# 5. å®‰è£… Git
sudo apt install git -y

# 6. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/aigc-agent
sudo chown ubuntu:ubuntu /var/www/aigc-agent

# 7. å…‹éš†ä»£ç 
cd /var/www/aigc-agent
git clone https://github.com/ZhehuanUnique/AIGC-jubianage-agent.git .

# 8. å®‰è£…ä¾èµ–
npm install
cd server
npm install
cd ..

# 9. æ„å»ºå‰ç«¯
npm run build
```

---

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/aigc-agent/server
cp env.example .env
nano .env
```

**å¿…é¡»é…ç½®çš„å˜é‡**ï¼š

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3002

# é€šä¹‰åƒé—® API å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
DASHSCOPE_API_KEY=sk-your-api-key-here

# æ¨¡å‹é€‰æ‹©
QWEN_MODEL=qwen-plus

# Supabase æ•°æ®åº“è¿æ¥ï¼ˆå¿…éœ€ï¼‰
# ä½¿ç”¨ Supabase è¿æ¥å­—ç¬¦ä¸²ï¼ˆSession Poolerï¼‰
DATABASE_URL=postgresql://postgres.ogndfzxtzsifaqwzfojs:your-password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# è…¾è®¯äº‘ COS é…ç½®ï¼ˆå¿…éœ€ï¼‰
COS_SECRET_ID=your-secret-id
COS_SECRET_KEY=your-secret-key
COS_REGION=ap-guangzhou
COS_BUCKET=your-bucket-name

# JWT å¯†é’¥ï¼ˆå¿…éœ€ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your-random-jwt-secret-key-here
```

**ä¿å­˜æ–‡ä»¶**ï¼šæŒ‰ `Ctrl + X`ï¼Œç„¶åæŒ‰ `Y`ï¼Œæœ€åæŒ‰ `Enter`

---

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd /var/www/aigc-agent/server
pm2 start index.js --name aigc-agent
pm2 save

# è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¾“å‡ºçš„ sudo å‘½ä»¤
```

**éªŒè¯æœåŠ¡**ï¼š

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-agent

# æµ‹è¯• API
curl http://localhost:3002/health
```

---

### ç¬¬å…­æ­¥ï¼šé…ç½® Nginx

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-nginx-config.sh
bash /tmp/setup-nginx-config.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/aigc-agent
```

**å¤åˆ¶ä»¥ä¸‹å†…å®¹**ï¼š

```nginx
server {
    listen 80;
    server_name jubianai.cn www.jubianai.cn;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/aigc-agent/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åç«¯ API
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /var/www/aigc-agent/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**å¯ç”¨é…ç½®**ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/aigc-agent /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx
```

---

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® SSL è¯ä¹¦

#### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x /tmp/setup-ssl.sh
bash /tmp/setup-ssl.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨é…ç½®

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d jubianai.cn -d www.jubianai.cn

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

### ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾ç«¯å£
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

### ç¬¬ä¹æ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 status

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥åç«¯ API
curl http://localhost:3002/health

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /var/www/aigc-agent/dist
```

**è®¿é—®ç½‘ç«™**ï¼š
- HTTPï¼šhttp://jubianai.cn
- HTTPSï¼šhttps://jubianai.cnï¼ˆé…ç½® SSL åï¼‰

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 ç®¡ç†

```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs aigc-agent     # æŸ¥çœ‹æ—¥å¿—
pm2 restart aigc-agent  # é‡å¯
pm2 stop aigc-agent     # åœæ­¢
pm2 delete aigc-agent   # åˆ é™¤
```

### Nginx ç®¡ç†

```bash
sudo systemctl status nginx    # æŸ¥çœ‹çŠ¶æ€
sudo systemctl restart nginx   # é‡å¯
sudo systemctl reload nginx    # é‡æ–°åŠ è½½é…ç½®
sudo nginx -t                  # æµ‹è¯•é…ç½®
```

### æ›´æ–°ä»£ç 

```bash
cd /var/www/aigc-agent
git pull origin main
npm install
cd server && npm install && cd ..
npm run build
pm2 restart aigc-agent
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¿æ¥å’Œ API å¯†é’¥
2. **åŸŸåè§£æ**ï¼šç¡®ä¿åŸŸå `jubianai.cn` å·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP `119.45.121.152`
3. **å®‰å…¨ç»„**ï¼šåœ¨è…¾è®¯äº‘æ§åˆ¶å°ç¡®ä¿å®‰å…¨ç»„å·²å¼€æ”¾ 22ã€80ã€443 ç«¯å£
4. **JWT å¯†é’¥**ï¼šç”Ÿæˆä¸€ä¸ªå¼ºéšæœºå­—ç¬¦ä¸²ä½œä¸º JWT_SECRET

---

## ğŸ› æ•…éšœæ’æŸ¥

### æ— æ³•è¿æ¥æœåŠ¡å™¨
- æ£€æŸ¥ IP åœ°å€å’Œå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 22 ç«¯å£

### PM2 æœåŠ¡æ— æ³•å¯åŠ¨
- æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs aigc-agent`
- æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`cat /var/www/aigc-agent/server/.env`
- æ‰‹åŠ¨æµ‹è¯•ï¼š`cd /var/www/aigc-agent/server && node index.js`

### Nginx 502 é”™è¯¯
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`pm2 status`
- æ£€æŸ¥ç«¯å£ï¼š`curl http://localhost:3002/health`
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`

### ç½‘ç«™æ— æ³•è®¿é—®
- æ£€æŸ¥ DNS è§£æï¼š`ping jubianai.cn`
- æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`
- æ£€æŸ¥ Nginxï¼š`sudo systemctl status nginx`



